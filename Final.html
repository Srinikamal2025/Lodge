<!DOCtype html>   
<html lang = "en"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Srini Kamal Residency - Hotel Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .room-box {
            transition: all 0.3s ease;
        }
        .room-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .room-available {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        .room-occupied {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        .room-maintenance {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .owner-only {
            display: none;
        }
        .owner-visible .owner-only {
            display: block;
        }
        .notification-badge {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .confirm-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md fade-in">
            <div class="text-center mb-8">
                <i class="fas fa-hotel text-5xl text-blue-600 mb-4"></i>
                <h1 class="text-3xl font-bold text-gray-800">Srini Kamal Residency</h1>
                <p class="text-gray-600 mt-2">Hotel Management System</p>
                <p class="text-gray-500 mt-1">Please login to continue</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                    <input type="text" id="username" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter username" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter password" required>
                </div>
                
                <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200 font-medium">
                    <i class="fas fa-sign-in-alt mr-2"></i>Login
                </button>
            </form>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboardScreen" class="hidden">
        <!-- Header -->
        <header class="bg-white shadow-md">
            <div class="container mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-4">
                        <i class="fas fa-hotel text-3xl text-blue-600"></i>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-800">Srini Kamal Residency</h1>
                            <p class="text-sm text-gray-600">Welcome, <span id="userRole" class="font-medium"></span></p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="openAllCustomersModal()" class="owner-only bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition duration-200">
                            <i class="fas fa-users mr-2"></i>View Customers
                        </button>
                        <div id="notificationContainer" class="owner-only relative">
                            <button onclick="toggleNotifications()" class="relative p-2 text-gray-600 hover:text-gray-800">
                                <i class="fas fa-bell text-xl"></i>
                                <span id="notificationBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center notification-badge hidden">0</span>
                            </button>
                            <div id="notificationDropdown" class="hidden absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg z-50">
                                <div class="p-4 border-b flex justify-between items-center">
                                    <h3 class="font-semibold text-gray-800">Notifications</h3>
                                    <button onclick="clearAllNotifications()" class="text-sm text-red-600 hover:text-red-800">
                                        <i class="fas fa-trash-alt mr-1"></i>Clear All
                                    </button>
                                </div>
                                <div id="notificationList" class="max-h-96 overflow-y-auto">
                                    <!-- Notifications will be listed here -->
                                </div>
                            </div>
                        </div>
                        <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-200">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Total Rooms</p>
                            <p class="text-2xl font-bold text-gray-800">29</p>
                        </div>
                        <i class="fas fa-door-open text-3xl text-blue-500"></i>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Available</p>
                            <p class="text-2xl font-bold text-green-600" id="availableCount">0</p>
                        </div>
                        <i class="fas fa-check-circle text-3xl text-green-500"></i>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Occupied</p>
                            <p class="text-2xl font-bold text-red-600" id="occupiedCount">0</p>
                        </div>
                        <i class="fas fa-user-friends text-3xl text-red-500"></i>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Maintenance</p>
                            <p class="text-2xl font-bold text-yellow-600" id="maintenanceCount">0</p>
                        </div>
                        <i class="fas fa-tools text-3xl text-yellow-500"></i>
                    </div>
                </div>
            </div>

            <!-- Revenue Cards -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">
                <div class="bg-white rounded-lg shadow p-6 owner-only">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Cash Counter</p>
                            <p class="text-2xl font-bold text-gray-800" id="cashCounter">₹0</p>
                        </div>
                        <i class="fas fa-money-bill-wave text-3xl text-green-500"></i>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-6 owner-only">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">UPI Counter</p>
                            <p class="text-2xl font-bold text-gray-800" id="upiCounter">₹0</p>
                        </div>
                        <i class="fas fa-mobile-alt text-3xl text-blue-500"></i>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-6 owner-only">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Day's Revenue</p>
                            <p class="text-2xl font-bold text-gray-800" id="dayRevenue">₹0</p>
                        </div>
                        <i class="fas fa-calendar-day text-3xl text-purple-500"></i>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-6 owner-only">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Monthly Revenue</p>
                            <p class="text-2xl font-bold text-gray-800" id="monthRevenue">₹0</p>
                        </div>
                        <i class="fas fa-calendar-alt text-3xl text-indigo-500"></i>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-6 owner-only">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Total Due</p>
                            <p class="text-2xl font-bold text-red-600" id="totalDue">₹0</p>
                        </div>
                        <i class="fas fa-exclamation-triangle text-3xl text-red-500"></i>
                    </div>
                </div>
            </div>

            <!-- Due Payments Section (Owner Only) -->
            <div class="bg-white rounded-lg shadow p-6 mb-8 owner-only">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Due Payments</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Room No.</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Amount</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Paid Amount</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Due Amount</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="duePaymentsTable" class="bg-white divide-y divide-gray-200">
                            <!-- Due payments will be listed here -->
                        </tbody>
                    </table>
                    <div id="noDuePayments" class="text-center py-4 text-gray-500">
                        No due payments
                    </div>
                </div>
            </div>

            <!-- Room Grid -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-6">Room Status</h2>
                <div id="roomGrid" class="grid grid-cols-2 md:grid-cols-5 lg:grid-cols-7 gap-4">
                    <!-- Rooms will be dynamically generated here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Room Detail Modal -->
    <div id="roomModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">Room Details</h3>
                    <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <form id="roomForm" class="space-y-4">
                    <input type="hidden" id="roomId">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Room Status</label>
                            <select id="roomStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="available">Available</option>
                                <option value="occupied">Occupied</option>
                                <option value="maintenance">Maintenance</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Room Price (₹/day)</label>
                            <input type="number" id="roomPrice" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter room price" min="0">
                        </div>
                    </div>

                    <div id="customerDetails" class="space-y-4">
                        <div class="bg-blue-50 p-4 rounded-lg mb-4">
                            <p class="text-sm font-medium text-blue-800 mb-2">
                                <i class="fas fa-info-circle mr-2"></i>Customer Recognition
                            </p>
                            <p id="customerRecognition" class="text-sm text-blue-700">
                                Enter Aadhar number to check if customer exists in our database
                            </p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Customer Name</label>
                                <input type="text" id="customerName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter customer name">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Aadhar Card Number</label>
                                <input type="text" id="aadharNumber" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter Aadhar number" maxlength="12" pattern="[0-9]{12}">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Number of Persons</label>
                                <input type="number" id="numberOfPersons" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter number of persons" min="1">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                                <input type="text" id="phoneNumber" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter phone number">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Check-in Time</label>
                                <input type="datetime-local" id="checkinTime" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Check-out Time</label>
                                <input type="datetime-local" id="checkoutTime" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Payment Mode</label>
                            <select id="paymentMode" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Select payment mode</option>
                                <option value="UPI">UPI</option>
                                <option value="cash">Cash</option>
                            </select>
                        </div>

                        <div id="paymentDetails" class="space-y-4">
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-medium text-gray-700">Total Amount:</span>
                                    <span id="totalAmount" class="text-sm font-bold text-gray-900">₹0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-700">Paid Amount:</span>
                                    <input type="number" id="paidAmount" class="w-32 px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" min="0">
                                </div>
                                <div class="flex justify-between items-center mt-2 pt-2 border-t border-gray-200">
                                    <span class="text-sm font-medium text-gray-700">Due Amount:</span>
                                    <span id="dueAmount" class="text-sm font-bold text-red-600">₹0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Customer History Section -->
                    <div id="customerHistorySection" class="hidden">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Customer History</h4>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Room</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Check-in</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Check-out</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="customerHistoryTable" class="bg-white divide-y divide-gray-200">
                                    <!-- Customer history will be listed here -->
                                </tbody>
                            </table>
                            <div id="noCustomerHistory" class="text-center py-4 text-gray-500">
                                No previous bookings found
                            </div>
                        </div>
                    </div>

                    <div class="flex space-x-4 pt-4">
                        <button type="submit" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200 font-medium">
                            <i class="fas fa-save mr-2"></i>Save Changes
                        </button>
                        <button type="button" onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition duration-200 font-medium">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Payment Modal (Owner Only) -->
    <div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center p-4 z-50 owner-only">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">Update Payment</h3>
                    <button onclick="closePaymentModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <form id="paymentForm" class="space-y-4">
                    <input type="hidden" id="paymentRoomId">
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-700">Room:</span>
                            <span id="paymentRoomNumber" class="text-sm font-bold text-gray-900">-</span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-700">Customer:</span>
                            <span id="paymentCustomerName" class="text-sm font-bold text-gray-900">-</span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-700">Total Amount:</span>
                            <span id="paymentTotalAmount" class="text-sm font-bold text-gray-900">₹0</span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-700">Already Paid:</span>
                            <span id="paymentAlreadyPaid" class="text-sm font-bold text-gray-900">₹0</span>
                        </div>
                        <div class="flex justify-between items-center pt-2 border-t border-gray-200">
                            <span class="text-sm font-medium text-gray-700">Due Amount:</span>
                            <span id="paymentDueAmount" class="text-sm font-bold text-red-600">₹0</span>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Additional Payment Amount</label>
                        <input type="number" id="additionalPayment" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter additional payment amount" min="0">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Payment Mode</label>
                        <select id="additionalPaymentMode" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Select payment mode</option>
                            <option value="UPI">UPI</option>
                            <option value="cash">Cash</option>
                        </select>
                    </div>

                    <div class="flex space-x-4 pt-4">
                        <button type="submit" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200 font-medium">
                            <i class="fas fa-save mr-2"></i>Update Payment
                        </button>
                        <button type="button" onclick="closePaymentModal()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition duration-200 font-medium">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- All Customers Modal (Owner Only) -->
    <div id="allCustomersModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center p-4 z-50 owner-only">
        <div class="bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">All Customers</h3>
                    <button onclick="closeAllCustomersModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <div class="mb-4">
                    <div class="relative">
                        <input type="text" id="customerSearch" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Search customers by name or Aadhar...">
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aadhar</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Bookings</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Visit</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="allCustomersTable" class="bg-white divide-y divide-gray-200">
                            <!-- Customers will be listed here -->
                        </tbody>
                    </table>
                    <div id="noCustomersFound" class="text-center py-4 text-gray-500 hidden">
                        No customers found
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal (Owner Only) -->
    <div id="confirmModal" class="hidden confirm-modal">
        <div class="confirm-content">
            <h3 class="text-lg font-bold mb-4">Confirm Action</h3>
            <p id="confirmMessage" class="mb-6">Are you sure you want to perform this action?</p>
            <div class="flex space-x-4">
                <button id="confirmYes" class="flex-1 bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition duration-200 font-medium">
                    Yes
                </button>
                <button id="confirmNo" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition duration-200 font-medium">
                    No
                </button>
            </div>
        </div>
    </div>

    <script>
        // User credentials
        const users = {
            owner: { password: 'msn2021$', role: 'Owner' },
            manager: { password: 'manager2025', role: 'Manager' }
        };

        // Current user
        let currentUser = null;

        // Initialize rooms data
        let rooms = JSON.parse(localStorage.getItem('hotelRooms')) || [];
        if (rooms.length === 0) {
            for (let i = 1; i <= 29; i++) {
                rooms.push({
                    id: i,
                    status: 'available',
                    price: 1000 + Math.floor(Math.random() * 2000), // Random price between 1000-3000
                    customerName: '',
                    numberOfPersons: 1,
                    aadharNumber: '',
                    phoneNumber: '',
                    checkinTime: '',
                    checkoutTime: '',
                    paymentMode: '',
                    totalAmount: 0,
                    paidAmount: 0,
                    dueAmount: 0
                });
            }
            localStorage.setItem('hotelRooms', JSON.stringify(rooms));
        }

        // Initialize payment data
        let payments = JSON.parse(localStorage.getItem('hotelPayments')) || {
            cash: 0,
            upi: 0,
            dayRevenue: 0,
            monthRevenue: 0,
            lastUpdated: null
        };

        // Initialize notifications
        let notifications = JSON.parse(localStorage.getItem('hotelNotifications')) || [];

        // Initialize customer database
        let customersDB = JSON.parse(localStorage.getItem('hotelCustomersDB')) || [];

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (users[username] && users[username].password === password) {
                currentUser = { username, role: users[username].role };
                document.getElementById('userRole').textContent = currentUser.role;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('dashboardScreen').classList.remove('hidden');
                
                // Show owner-only elements if user is owner
                if (currentUser.role === 'Owner') {
                    document.getElementById('dashboardScreen').classList.add('owner-visible');
                    updateNotificationBadge();
                    updateDuePaymentsTable();
                    updateTotalDue();
                    
                    // Show a success message if there are new notifications
                    if (notifications.length > 0) {
                        showNotification(`You have ${notifications.length} new notification(s)`, 'success');
                    }
                }
                
                renderRooms();
                updateStats();
                updatePaymentCounters(); // This will update values in DOM for owner to see later
            } else {
                showNotification('Invalid credentials!', 'error');
            }
        });

        // Logout functionality
        function logout() {
            currentUser = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('dashboardScreen').classList.add('hidden');
            document.getElementById('dashboardScreen').classList.remove('owner-visible');
            document.getElementById('loginForm').reset();
        }

        // Customer database functions
        function findCustomerByAadhar(aadhar) {
            return customersDB.find(customer => customer.aadhar === aadhar);
        }

        function addCustomer(customer) {
            customer.id = Date.now().toString(36) + Math.random().toString(36).substr(2);
            customer.createdAt = new Date().toISOString();
            customer.history = [];
            customersDB.push(customer);
            localStorage.setItem('hotelCustomersDB', JSON.stringify(customersDB));
            return customer;
        }

        function updateCustomerHistory(aadhar, bookingInfo) {
            const customerIndex = customersDB.findIndex(customer => customer.aadhar === aadhar);
            if (customerIndex !== -1) {
                customersDB[customerIndex].history.push(bookingInfo);
                localStorage.setItem('hotelCustomersDB', JSON.stringify(customersDB));
            }
        }

        // Render rooms
        function renderRooms() {
            const roomGrid = document.getElementById('roomGrid');
            roomGrid.innerHTML = '';

            rooms.forEach(room => {
                const roomBox = document.createElement('div');
                roomBox.className = `room-box rounded-lg p-4 text-white cursor-pointer ${getRoomClass(room.status)}`;
                roomBox.onclick = () => openRoomModal(room.id);

                let customerInfo = '';
                if (room.status === 'occupied' && room.customerName) {
                    customerInfo = `<p class="text-xs mt-1 truncate">${room.customerName}</p>`;
                    if (room.numberOfPersons) {
                        customerInfo += `<p class="text-xs mt-1">${room.numberOfPersons} ${room.numberOfPersons > 1 ? 'persons' : 'person'}</p>`;
                    }
                    if (room.dueAmount > 0) {
                        customerInfo += `<p class="text-xs mt-1 font-bold">Due: ₹${room.dueAmount}</p>`;
                    }
                }

                roomBox.innerHTML = `
                    <div class="text-center">
                        <i class="fas fa-bed text-2xl mb-2"></i>
                        <p class="font-bold">Room ${room.id}</p>
                        <p class="text-xs mt-1 capitalize">${room.status}</p>
                        <p class="text-xs mt-1">₹${room.price}/day</p>
                        ${customerInfo}
                    </div>
                `;

                roomGrid.appendChild(roomBox);
            });
        }

        // Get room class based on status
        function getRoomClass(status) {
            switch(status) {
                case 'available': return 'room-available';
                case 'occupied': return 'room-occupied';
                case 'maintenance': return 'room-maintenance';
                default: return 'room-available';
            }
        }

        // Update statistics
        function updateStats() {
            const available = rooms.filter(r => r.status === 'available').length;
            const occupied = rooms.filter(r => r.status === 'occupied').length;
            const maintenance = rooms.filter(r => r.status === 'maintenance').length;

            document.getElementById('availableCount').textContent = available;
            document.getElementById('occupiedCount').textContent = occupied;
            document.getElementById('maintenanceCount').textContent = maintenance;
        }

        // Update payment counters
        function updatePaymentCounters() {
            // Always update DOM values, regardless of user role
            // The visibility is handled by 'owner-only' CSS class
            const cashCounter = document.getElementById('cashCounter');
            const upiCounter = document.getElementById('upiCounter');
            const dayRevenue = document.getElementById('dayRevenue');
            const monthRevenue = document.getElementById('monthRevenue');
            
            if (cashCounter) cashCounter.textContent = `₹${payments.cash}`;
            if (upiCounter) upiCounter.textContent = `₹${payments.upi}`;
            if (dayRevenue) dayRevenue.textContent = `₹${payments.dayRevenue}`;
            if (monthRevenue) monthRevenue.textContent = `₹${payments.monthRevenue}`;
        }

        // Update total due amount
        function updateTotalDue() {
            if (currentUser && currentUser.role === 'Owner') {
                const totalDue = rooms.reduce((sum, room) => sum + (room.dueAmount || 0), 0);
                const totalDueElement = document.getElementById('totalDue');
                if (totalDueElement) totalDueElement.textContent = `₹${totalDue}`;
            }
        }

        // Update due payments table
        function updateDuePaymentsTable() {
            if (currentUser && currentUser.role !== 'Owner') return;
            
            const duePaymentsTable = document.getElementById('duePaymentsTable');
            const noDuePayments = document.getElementById('noDuePayments');
            
            if (!duePaymentsTable || !noDuePayments) return;
            
            // Clear existing rows
            duePaymentsTable.innerHTML = '';
            
            // Filter rooms with due amounts
            const dueRooms = rooms.filter(room => room.status === 'occupied' && room.dueAmount > 0);
            
            if (dueRooms.length === 0) {
                noDuePayments.style.display = 'block';
                return;
            }
            
            noDuePayments.style.display = 'none';
            
            dueRooms.forEach(room => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${room.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${room.customerName || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">₹${room.totalAmount || 0}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">₹${room.paidAmount || 0}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-red-600">₹${room.dueAmount || 0}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="openPaymentModal(${room.id})" class="text-blue-600 hover:text-blue-900">Update Payment</button>
                    </td>
                `;
                duePaymentsTable.appendChild(row);
            });
        }

        // Clear all notifications (Owner only)
        function clearAllNotifications() {
            if (currentUser && currentUser.role !== 'Owner') {
                showNotification('Only owner can clear notifications!', 'error');
                return;
            }
            
            showConfirmModal('Are you sure you want to clear all notifications?', function() {
                notifications = [];
                localStorage.setItem('hotelNotifications', JSON.stringify(notifications));
                updateNotificationBadge();
                loadNotifications();
                showNotification('All notifications have been cleared!', 'success');
            });
        }

        // Show confirmation modal
        function showConfirmModal(message, onConfirm) {
            const confirmModal = document.getElementById('confirmModal');
            const confirmMessage = document.getElementById('confirmMessage');
            const confirmYes = document.getElementById('confirmYes');
            const confirmNo = document.getElementById('confirmNo');
            
            confirmMessage.textContent = message;
            confirmModal.classList.remove('hidden');
            
            // Remove existing event listeners
            const newConfirmYes = confirmYes.cloneNode(true);
            const newConfirmNo = confirmNo.cloneNode(true);
            confirmYes.parentNode.replaceChild(newConfirmYes, confirmYes);
            confirmNo.parentNode.replaceChild(newConfirmNo, confirmNo);
            
            // Add new event listeners
            newConfirmYes.addEventListener('click', function() {
                onConfirm();
                confirmModal.classList.add('hidden');
            });
            
            newConfirmNo.addEventListener('click', function() {
                confirmModal.classList.add('hidden');
            });
        }

        // Toggle notifications dropdown
        function toggleNotifications() {
            const dropdown = document.getElementById('notificationDropdown');
            if (!dropdown) return;
            
            dropdown.classList.toggle('hidden');
            
            if (!dropdown.classList.contains('hidden')) {
                loadNotifications();
            }
        }

        // Load notifications
        function loadNotifications() {
            const notificationList = document.getElementById('notificationList');
            if (!notificationList) return;
            
            notificationList.innerHTML = '';
            
            if (notifications.length === 0) {
                notificationList.innerHTML = '<p class="p-4 text-gray-500 text-center">No notifications</p>';
                return;
            }
            
            notifications.forEach(notification => {
                const notificationItem = document.createElement('div');
                notificationItem.className = 'p-4 border-b hover:bg-gray-50';
                notificationItem.innerHTML = `
                    <p class="text-gray-800">${notification.message}</p>
                    <p class="text-xs text-gray-500 mt-2">${new Date(notification.timestamp).toLocaleString()}</p>
                `;
                notificationList.appendChild(notificationItem);
            });
        }

        // Update notification badge
        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            if (!badge) return;
            
            if (notifications.length > 0) {
                badge.textContent = notifications.length;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        // Add notification
        function addNotification(message) {
            notifications.push({
                message,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('hotelNotifications', JSON.stringify(notifications));
            updateNotificationBadge();
        }

        // Search for customer as Aadhar number is entered
        document.getElementById('aadharNumber').addEventListener('input', function(e) {
            const aadharNumber = e.target.value;
            const customerRecognition = document.getElementById('customerRecognition');
            
            if (aadharNumber.length >= 4) {
                const customer = findCustomerByAadhar(aadharNumber);
                
                if (customer) {
                    customerRecognition.innerHTML = `
                        <i class="fas fa-check-circle text-green-600 mr-2"></i>
                        Customer found: <strong>${customer.name}</strong>
                    `;
                    
                    // Auto-fill customer details
                    document.getElementById('customerName').value = customer.name;
                    document.getElementById('phoneNumber').value = customer.phoneNumber || '';
                    
                    // Show customer history
                    showCustomerHistory(customer);
                } else {
                    customerRecognition.innerHTML = `
                        <i class="fas fa-search text-blue-600 mr-2"></i>
                        Searching for customer...
                    `;
                    
                    // Hide customer history
                    document.getElementById('customerHistorySection').classList.add('hidden');
                }
            } else {
                customerRecognition.innerHTML = `
                    <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                    Enter Aadhar number to check if customer exists in our database
                `;
                
                // Hide customer history
                document.getElementById('customerHistorySection').classList.add('hidden');
            }
        });

        // Show customer history
        function showCustomerHistory(customer) {
            const historySection = document.getElementById('customerHistorySection');
            const historyTable = document.getElementById('customerHistoryTable');
            const noHistory = document.getElementById('noCustomerHistory');
            
            historySection.classList.remove('hidden');
            historyTable.innerHTML = '';
            
            if (customer.history && customer.history.length > 0) {
                noHistory.classList.add('hidden');
                
                customer.history.forEach(booking => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">${booking.roomId}</td>
                        <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-500">${new Date(booking.checkinTime).toLocaleDateString()}</td>
                        <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-500">${new Date(booking.checkoutTime).toLocaleDateString()}</td>
                        <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-500">₹${booking.totalAmount}</td>
                        <td class="px-4 py-2 whitespace-nowrap text-sm">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${booking.dueAmount > 0 ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                ${booking.dueAmount > 0 ? 'Due' : 'Paid'}
                            </span>
                        </td>
                    `;
                    historyTable.appendChild(row);
                });
            } else {
                noHistory.classList.remove('hidden');
            }
        }

        // Open room modal
        function openRoomModal(roomId) {
            const room = rooms.find(r => r.id === roomId);
            if (!room) return;

            document.getElementById('roomId').value = room.id;
            document.getElementById('roomStatus').value = room.status;
            document.getElementById('roomPrice').value = room.price;
            document.getElementById('customerName').value = room.customerName || '';
            document.getElementById('numberOfPersons').value = room.numberOfPersons || 1;
            document.getElementById('aadharNumber').value = room.aadharNumber || '';
            document.getElementById('phoneNumber').value = room.phoneNumber || '';
            document.getElementById('checkinTime').value = room.checkinTime || '';
            document.getElementById('checkoutTime').value = room.checkoutTime || '';
            document.getElementById('paymentMode').value = room.paymentMode || '';
            document.getElementById('paidAmount').value = room.paidAmount || 0;

            // Set field permissions based on user role
            if (currentUser.role === 'Manager') {
                // Manager can edit all customer details and payment information
                document.getElementById('roomPrice').setAttribute('readonly', true);
                document.getElementById('customerName').removeAttribute('readonly');
                document.getElementById('numberOfPersons').removeAttribute('readonly');
                document.getElementById('aadharNumber').removeAttribute('readonly');
                document.getElementById('phoneNumber').removeAttribute('readonly');
                document.getElementById('checkinTime').removeAttribute('readonly');
                document.getElementById('checkoutTime').removeAttribute('readonly');
                document.getElementById('paymentMode').removeAttribute('disabled');
                document.getElementById('paidAmount').removeAttribute('readonly');
            } else {
                // Owner can edit everything
                document.getElementById('roomPrice').removeAttribute('readonly');
                document.getElementById('customerName').removeAttribute('readonly');
                document.getElementById('numberOfPersons').removeAttribute('readonly');
                document.getElementById('aadharNumber').removeAttribute('readonly');
                document.getElementById('phoneNumber').removeAttribute('readonly');
                document.getElementById('checkinTime').removeAttribute('readonly');
                document.getElementById('checkoutTime').removeAttribute('readonly');
                document.getElementById('paymentMode').removeAttribute('disabled');
                document.getElementById('paidAmount').removeAttribute('readonly');
            }

            // Show/hide customer details based on room status
            if (room.status !== 'occupied') {
                document.getElementById('customerDetails').style.display = 'none';
            } else {
                document.getElementById('customerDetails').style.display = 'block';
                calculateTotalAmount();
                
                // Check if customer exists in database
                if (room.aadharNumber) {
                    const customer = findCustomerByAadhar(room.aadharNumber);
                    if (customer) {
                        showCustomerHistory(customer);
                    }
                }
            }

            document.getElementById('roomModal').classList.remove('hidden');
        }

        // Close modal
        function closeModal() {
            document.getElementById('roomModal').classList.add('hidden');
        }

        // Calculate total amount based on room price and stay duration
        function calculateTotalAmount() {
            const roomPrice = parseInt(document.getElementById('roomPrice').value) || 0;
            const checkinTime = new Date(document.getElementById('checkinTime').value);
            const checkoutTime = new Date(document.getElementById('checkoutTime').value);
            
            if (checkinTime && checkoutTime && checkinTime < checkoutTime) {
                const days = Math.max(1, Math.ceil((checkoutTime - checkinTime) / (1000 * 60 * 60 * 24)));
                const totalAmount = roomPrice * days;
                
                document.getElementById('totalAmount').textContent = `₹${totalAmount}`;
                
                const paidAmount = parseInt(document.getElementById('paidAmount').value) || 0;
                const dueAmount = Math.max(0, totalAmount - paidAmount);
                
                document.getElementById('dueAmount').textContent = `₹${dueAmount}`;
            } else {
                document.getElementById('totalAmount').textContent = '₹0';
                document.getElementById('dueAmount').textContent = '₹0';
            }
        }

        // Update due amount when paid amount changes
        document.getElementById('paidAmount').addEventListener('input', calculateTotalAmount);

        // Update total amount when room price or dates change
        document.getElementById('roomPrice').addEventListener('input', calculateTotalAmount);
        document.getElementById('checkinTime').addEventListener('change', calculateTotalAmount);
        document.getElementById('checkoutTime').addEventListener('change', calculateTotalAmount);

        // Handle room form submission
        document.getElementById('roomForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const roomId = parseInt(document.getElementById('roomId').value);
            const roomIndex = rooms.findIndex(r => r.id === roomId);
            
            if (roomIndex === -1) return;

            const oldStatus = rooms[roomIndex].status;
            const newStatus = document.getElementById('roomStatus').value;
            const newPaymentMode = document.getElementById('paymentMode').value;
            const roomPrice = parseInt(document.getElementById('roomPrice').value) || 0;

            // Calculate total amount if room is occupied
            let totalAmount = 0;
            if (newStatus === 'occupied') {
                const checkinTime = new Date(document.getElementById('checkinTime').value);
                const checkoutTime = new Date(document.getElementById('checkoutTime').value);
                
                if (checkinTime && checkoutTime && checkinTime < checkoutTime) {
                    const days = Math.max(1, Math.ceil((checkoutTime - checkinTime) / (1000 * 60 * 60 * 24)));
                    totalAmount = roomPrice * days;
                }
            }

            const paidAmount = parseInt(document.getElementById('paidAmount').value) || 0;
            const dueAmount = Math.max(0, totalAmount - paidAmount);

            // Get customer details
            const customerName = document.getElementById('customerName').value;
            const aadharNumber = document.getElementById('aadharNumber').value;
            const numberOfPersons = parseInt(document.getElementById('numberOfPersons').value) || 1;
            const phoneNumber = document.getElementById('phoneNumber').value;
            const checkinTime = document.getElementById('checkinTime').value;
            const checkoutTime = document.getElementById('checkoutTime').value;

            // Check if customer exists in database
            let customer = findCustomerByAadhar(aadharNumber);
            
            if (!customer && aadharNumber) {
                // Add new customer to database
                customer = addCustomer({
                    name: customerName,
                    aadhar: aadharNumber,
                    phoneNumber: phoneNumber
                });
            }

            // Update room data
            rooms[roomIndex].status = newStatus;
            rooms[roomIndex].price = roomPrice;
            rooms[roomIndex].customerName = customerName;
            rooms[roomIndex].numberOfPersons = numberOfPersons;
            rooms[roomIndex].aadharNumber = aadharNumber;
            rooms[roomIndex].phoneNumber = phoneNumber;
            rooms[roomIndex].checkinTime = checkinTime;
            rooms[roomIndex].checkoutTime = checkoutTime;
            rooms[roomIndex].paymentMode = newPaymentMode;
            rooms[roomIndex].totalAmount = totalAmount;
            rooms[roomIndex].paidAmount = paidAmount;
            rooms[roomIndex].dueAmount = dueAmount;

            // Update customer history if room is occupied
            if (newStatus === 'occupied' && aadharNumber) {
                updateCustomerHistory(aadharNumber, {
                    roomId: roomId,
                    checkinTime: checkinTime,
                    checkoutTime: checkoutTime,
                    totalAmount: totalAmount,
                    paidAmount: paidAmount,
                    dueAmount: dueAmount
                });
            }

            // Update payment counters when room is set to occupied (for both owner and manager)
            if (oldStatus !== 'occupied' && newStatus === 'occupied' && newPaymentMode && paidAmount > 0) {
                if (newPaymentMode === 'cash') {
                    payments.cash += paidAmount;
                } else if (newPaymentMode === 'UPI') {
                    payments.upi += paidAmount;
                }

                // Update day and month revenue
                const today = new Date().toDateString();
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                
                if (!payments.lastUpdated || new Date(payments.lastUpdated).toDateString() !== today) {
                    payments.dayRevenue = paidAmount;
                } else {
                    payments.dayRevenue += paidAmount;
                }
                
                if (!payments.lastUpdated || 
                    new Date(payments.lastUpdated).getMonth() !== currentMonth || 
                    new Date(payments.lastUpdated).getFullYear() !== currentYear) {
                    payments.monthRevenue = paidAmount;
                } else {
                    payments.monthRevenue += paidAmount;
                }
                
                payments.lastUpdated = new Date().toISOString();
                localStorage.setItem('hotelPayments', JSON.stringify(payments));
                
                // Always update payment counters in DOM
                updatePaymentCounters();

                // Send notification to owner
                const notificationMessage = `Payment of ₹${paidAmount} received via ${newPaymentMode} for Room ${roomId} by ${currentUser.role}`;
                addNotification(notificationMessage);
                
                if (currentUser.role === 'Manager') {
                    showNotification('Payment received and owner notified!', 'success');
                }
            }

            // Save to localStorage
            localStorage.setItem('hotelRooms', JSON.stringify(rooms));

            // Update UI
            renderRooms();
            updateStats();
            updatePaymentCounters();
            updateDuePaymentsTable();
            updateTotalDue();
            closeModal();
            showNotification('Room updated successfully!', 'success');
        });

        // Open all customers modal
        function openAllCustomersModal() {
            if (currentUser && currentUser.role !== 'Owner') {
                showNotification('Only owner can view all customers!', 'error');
                return;
            }
            
            document.getElementById('allCustomersModal').classList.remove('hidden');
            renderAllCustomers();
        }

        // Close all customers modal
        function closeAllCustomersModal() {
            document.getElementById('allCustomersModal').classList.add('hidden');
        }

        // Render all customers
        function renderAllCustomers() {
            const customersTable = document.getElementById('allCustomersTable');
            const noCustomers = document.getElementById('noCustomersFound');
            
            if (!customersTable || !noCustomers) return;
            
            // Clear existing rows
            customersTable.innerHTML = '';
            
            if (customersDB.length === 0) {
                noCustomers.classList.remove('hidden');
                return;
            }
            
            noCustomers.classList.add('hidden');
            
            customersDB.forEach(customer => {
                const row = document.createElement('tr');
                const lastVisit = customer.history && customer.history.length > 0 ? 
                    new Date(customer.history[customer.history.length - 1].checkinTime).toLocaleDateString() : 
                    'No visits';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${customer.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${customer.aadhar}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${customer.phoneNumber || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${customer.history ? customer.history.length : 0}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${lastVisit}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="viewCustomerDetails('${customer.aadhar}')" class="text-blue-600 hover:text-blue-900">View Details</button>
                    </td>
                `;
                customersTable.appendChild(row);
            });
        }

        // View customer details
        function viewCustomerDetails(aadhar) {
            const customer = findCustomerByAadhar(aadhar);
            if (!customer) return;
            
            // Close all customers modal
            closeAllCustomersModal();
            
            // Find a room to open (preferably available)
            const availableRoom = rooms.find(r => r.status === 'available');
            if (availableRoom) {
                openRoomModal(availableRoom.id);
                // Pre-fill customer details
                setTimeout(() => {
                    document.getElementById('customerName').value = customer.name;
                    document.getElementById('aadharNumber').value = customer.aadhar;
                    document.getElementById('phoneNumber').value = customer.phoneNumber || '';
                    showCustomerHistory(customer);
                }, 100);
            } else {
                showNotification('No available rooms to assign customer!', 'error');
            }
        }

        // Search customers
        document.getElementById('customerSearch').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#allCustomersTable tr');
            
            rows.forEach(row => {
                const name = row.cells[0].textContent.toLowerCase();
                const aadhar = row.cells[1].textContent.toLowerCase();
                
                if (name.includes(searchTerm) || aadhar.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });

        // Open payment modal
        function openPaymentModal(roomId) {
            if (currentUser.role !== 'Owner') return;
            
            const room = rooms.find(r => r.id === roomId);
            if (!room) return;

            document.getElementById('paymentRoomId').value = room.id;
            document.getElementById('paymentRoomNumber').textContent = room.id;
            document.getElementById('paymentCustomerName').textContent = room.customerName || '-';
            document.getElementById('paymentTotalAmount').textContent = `₹${room.totalAmount || 0}`;
            document.getElementById('paymentAlreadyPaid').textContent = `₹${room.paidAmount || 0}`;
            document.getElementById('paymentDueAmount').textContent = `₹${room.dueAmount || 0}`;
            document.getElementById('additionalPayment').value = '';
            document.getElementById('additionalPaymentMode').value = '';

            document.getElementById('paymentModal').classList.remove('hidden');
        }

        // Close payment modal
        function closePaymentModal() {
            document.getElementById('paymentModal').classList.add('hidden');
        }

        // Handle payment form submission
        document.getElementById('paymentForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const roomId = parseInt(document.getElementById('paymentRoomId').value);
            const roomIndex = rooms.findIndex(r => r.id === roomId);
            
            if (roomIndex === -1) return;

            const additionalPayment = parseInt(document.getElementById('additionalPayment').value) || 0;
            const paymentMode = document.getElementById('additionalPaymentMode').value;

            if (additionalPayment <= 0 || !paymentMode) {
                showNotification('Please enter a valid payment amount and select payment mode!', 'error');
                return;
            }

            // Update room payment information
            rooms[roomIndex].paidAmount += additionalPayment;
            rooms[roomIndex].dueAmount = Math.max(0, rooms[roomIndex].dueAmount - additionalPayment);

            // Update payment counters
            if (paymentMode === 'cash') {
                payments.cash += additionalPayment;
            } else if (paymentMode === 'UPI') {
                payments.upi += additionalPayment;
            }

            // Update day and month revenue
            const today = new Date().toDateString();
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            if (!payments.lastUpdated || new Date(payments.lastUpdated).toDateString() !== today) {
                payments.dayRevenue = additionalPayment;
            } else {
                payments.dayRevenue += additionalPayment;
            }
            
            if (!payments.lastUpdated || 
                new Date(payments.lastUpdated).getMonth() !== currentMonth || 
                new Date(payments.lastUpdated).getFullYear() !== currentYear) {
                payments.monthRevenue = additionalPayment;
            } else {
                payments.monthRevenue += additionalPayment;
            }
            
            payments.lastUpdated = new Date().toISOString();
            localStorage.setItem('hotelPayments', JSON.stringify(payments));

            // Save to localStorage
            localStorage.setItem('hotelRooms', JSON.stringify(rooms));

            // Update UI
            renderRooms();
            updatePaymentCounters();
            updateDuePaymentsTable();
            updateTotalDue();
            closePaymentModal();
            
            showNotification(`Payment of ₹${additionalPayment} received via ${paymentMode} for Room ${roomId}!`, 'success');
            
            // Add notification
            const notificationMessage = `Additional payment of ₹${additionalPayment} received via ${paymentMode} for Room ${roomId}`;
            addNotification(notificationMessage);
        });

        // Show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white fade-in z-50 ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} mr-2"></i>
                    ${message}
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Handle status change to show/hide customer details
        document.getElementById('roomStatus').addEventListener('change', function(e) {
            const customerDetails = document.getElementById('customerDetails');
            if (e.target.value === 'occupied') {
                customerDetails.style.display = 'block';
                calculateTotalAmount();
            } else {
                customerDetails.style.display = 'none';
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Set default check-in time to current time
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('checkinTime').value = now.toISOString().slice(0, 16);
            
            // Set default check-out time to tomorrow
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('checkoutTime').value = tomorrow.toISOString().slice(0, 16);
        });

        // Close notification dropdown when clicking outside
        document.addEventListener('click', function(e) {
            const notificationContainer = document.getElementById('notificationContainer');
            const notificationDropdown = document.getElementById('notificationDropdown');
            
            if (notificationContainer && notificationDropdown && !notificationContainer.contains(e.target)) {
                notificationDropdown.classList.add('hidden');
            }
        });
    </script>
</body>
</html>